{% extends 'index.html' %}

{% block content %}

<div>
    <div>
        <p>Total Confirmed Cases</p>
        <div id="cases"></div>
    </div>
    <div>
        <p>Total Deaths</p>
        <div id="deaths"></div>
    </div>
    <div>
        <p>Total Recoveries</p>
        <div id="recoveries"></div>
    </div>
</div>

<div class="text-center">
    <div class="btn-group">
        <button type="button" class="btn btn-primary active">Orthographic Heatmap</button>
        <button type="button" class="btn btn-primary" {% if request.endpoint == '/coronavirus_bubble_map' %} class="active" {% endif %}>
            <a href="{{ url_for('coronavirus_bubble_map') }}"> Bubble Map</a>
        </button>
    </div>
</div>


<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.1.0/papaparse.min.js"></script>
<!--
<script type="text/javascript" src="{{ url_for('static', filename='javascript/global_stats.js') }}"></script>
-->

<script>
    Papa.parse("https://raw.githubusercontent.com/datasets/covid-19/master/data/worldwide-aggregated.csv", {
            download: true,
            header: true,
            complete: getStats
    })

    function formatDate() {
        var d = new Date()
        d.setDate(d.getDate() - 1);
        var month = '' + (d.getMonth() + 1)
        var day = '' + d.getDate()
        var year = d.getFullYear();

        if (month.length < 2) 
            month = '0' + month;
        if (day.length < 2) 
            day = '0' + day;

        return [year, month, day].join('-');
    }

    function getStats(results) {
        // create a date object using Date constructor 
        //var dateObj = new Date(); 
        // subtract one day from current time                           
        //dateObj.setDate(dateObj.getDate() - 1);
        var date = formatDate();
        //var table = "<table class='table table-bordered table-striped'>";
        var data = results.data;
        var cases = 0;
        var deaths = 0;
        var recoveries = 0;

        
        for (i = 0; i < data.length; i++){
            //table = "<tr>";
            var row = data[i];
            d = row["Date"];
            console.log(row);
            if (d === date) {
                cases = parseInt(row["Confirmed"]);
                deaths = parseInt(row["Deaths"]);
                recoveries = parseInt(row["Recovered"]);
            }
            
            /*
            var cells = row.join(",").split(",");
            
            for (j = 0; j < cells.length; j++){
                table += "<td>";
                table += cells[j];
                table += "</th>";
            }
            table += "</tr>";
            */
        }
        let casesString = "<p class='text-danger'>" + cases + "</p>";
        let deathString = "<p class='text-dark'>" + deaths + "</p>";
        let recoveriesString = "<p class='text-success'>" + recoveries + "</p>";
        //console.log(deathString);
        $("#cases").html(casesString);
        $("#deaths").html(deathString);
        $("#recoveries").html(recoveriesString);
    }
</script>

<!--
<script>
    Papa.parse("https://raw.githubusercontent.com/datasets/covid-19/master/data/worldwide-aggregated.csv", {
        download: true,
        header: true,
	    complete: displayHTMLTable
    })

    function formatDate() {
        var d = new Date()
        d.setDate(d.getDate() - 1);
        var month = '' + (d.getMonth() + 1)
        var day = '' + d.getDate()
        var year = d.getFullYear();

        if (month.length < 2) 
            month = '0' + month;
        if (day.length < 2) 
            day = '0' + day;

        return [year, month, day].join('-');
    }
    
    function displayHTMLTable(results) {
         // create a date object using Date constructor 
        //var dateObj = new Date(); 
        // subtract one day from current time                           
        //dateObj.setDate(dateObj.getDate() - 1);
        var date = formatDate();
        //var table = "<table class='table table-bordered table-striped'>";
        var data = results.data;
        var deaths = 0;

        
        for (i = 0; i < data.length; i++){
            //table = "<tr>";
            var row = data[i];
            d = row["Date"];
            if (d === date) {
                cases = row["Confirmed"];
                deaths = parseInt(cases);
            }
            
            /*
            var cells = row.join(",").split(",");
            
            for (j = 0; j < cells.length; j++){
                table += "<td>";
                table += cells[j];
                table += "</th>";
            }
            table += "</tr>";
            */
        }
        let deathString = "<p class='text-danger'>" + deaths + "</p>";
        //table += "</table>";
        console.log(deathString);
        $("#cases").html(deathString);
    }
</script>
-->

{% include 'plots/global-coronavirus-cases.html' %}
{% endblock %}